{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useCallback, useEffect, useReducer } from 'react';\nimport { useFetch } from 'shared/hooks/useFetch';\nvar ActionType = /*#__PURE__*/function (ActionType) {\n  ActionType[\"ChangeFilter\"] = \"change-filter\";\n  ActionType[\"ChangePage\"] = \"change-page\";\n  ActionType[\"AppendData\"] = \"append-data\";\n  return ActionType;\n}(ActionType || {});\nfunction constructURL(url) {\n  let params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const queryParams = Object.keys(params).map(paramName => `${paramName}=${params[paramName]}`).join('&');\n  if (!queryParams) {\n    return url;\n  }\n  return `${url}?${queryParams}`;\n}\nfunction reducer(state, action) {\n  const {\n    type,\n    payload\n  } = action;\n  switch (type) {\n    default:\n      return state;\n    case ActionType.ChangeFilter:\n      // fixme: try to avoid using as\n      return {\n        ...state,\n        filter: {\n          ...state.filter,\n          ...payload\n        },\n        currentPage: 1,\n        data: []\n      };\n    case ActionType.ChangePage:\n      return {\n        ...state,\n        currentPage: payload\n      };\n    case ActionType.AppendData:\n      return {\n        ...state,\n        data: [...state.data, ...payload]\n      };\n  }\n}\nexport const usePagedFetch = (endpoint, options) => {\n  _s();\n  const {\n    limit = 10,\n    page = 1,\n    filter\n  } = options !== null && options !== void 0 ? options : {};\n  const [state, dispatch] = useReducer(reducer, {\n    limit,\n    currentPage: page,\n    filter,\n    data: []\n  });\n  const {\n    data: fetched,\n    status,\n    error\n  } = useFetch(constructURL(endpoint, {\n    ...state.filter,\n    page: state.currentPage,\n    limit: state.limit\n  }), options);\n  useEffect(() => {\n    if (fetched !== null && fetched !== void 0 && fetched.data) {\n      dispatch({\n        type: ActionType.AppendData,\n        payload: fetched.data\n      });\n    }\n  }, [fetched === null || fetched === void 0 ? void 0 : fetched.data]);\n  const getNextPage = useCallback(() => dispatch({\n    type: ActionType.ChangePage,\n    payload: state.currentPage + 1\n  }), [state.currentPage]);\n  const getPrevPage = useCallback(() => dispatch({\n    type: ActionType.ChangePage,\n    payload: state.currentPage - 1\n  }), [state.currentPage]);\n  const getSpecPage = useCallback(page => dispatch({\n    type: ActionType.ChangePage,\n    payload: page\n  }), []);\n  const changeFilter = useCallback(filter => dispatch({\n    type: ActionType.ChangeFilter,\n    payload: filter\n  }), []);\n  return {\n    data: state.data,\n    filter: state.filter,\n    status,\n    error,\n    hasMore: Number(fetched === null || fetched === void 0 ? void 0 : fetched.totalPages) > state.currentPage,\n    totalPages: fetched === null || fetched === void 0 ? void 0 : fetched.totalPages,\n    getNextPage,\n    getPrevPage,\n    getSpecPage,\n    changeFilter\n  };\n};\n_s(usePagedFetch, \"gHHVjy4KkR1FmRhTUNFUJwMK80k=\", false, function () {\n  return [useFetch];\n});","map":{"version":3,"names":["useCallback","useEffect","useReducer","useFetch","ActionType","constructURL","url","params","arguments","length","undefined","queryParams","Object","keys","map","paramName","join","reducer","state","action","type","payload","ChangeFilter","filter","currentPage","data","ChangePage","AppendData","usePagedFetch","endpoint","options","_s","limit","page","dispatch","fetched","status","error","getNextPage","getPrevPage","getSpecPage","changeFilter","hasMore","Number","totalPages"],"sources":["/Users/creator/Documents/projects/Israel-project/client/src/shared/hooks/usePagedFetch.ts"],"sourcesContent":["import { Reducer, useCallback, useEffect, useReducer } from 'react';\nimport { useFetch, IFetchOptions, IState as IUseFetchState } from 'shared/hooks/useFetch';\n\nexport interface IPagedResponse<T> {\n  data: T[];\n  totalPages: number;\n}\n\nexport interface IUsePagedFetchResult<T, F = {}> extends IUseFetchState<T[]> {\n  hasMore: boolean;\n  getNextPage: () => void;\n  getPrevPage: () => void;\n  getSpecPage: (page: number) => void;\n  filter?: F;\n  changeFilter: (filter: Partial<F>) => void;\n  totalPages?: number;\n}\n\nexport interface IPagedFetchOptions<F = {}> extends IFetchOptions {\n  limit?: number;\n  page?: number;\n  filter?: F;\n}\n\nexport interface IState<T, F> {\n  currentPage: number;\n  limit: number;\n  filter?: F;\n  data: T[];\n}\n\nconst enum ActionType {\n  ChangeFilter = 'change-filter',\n  ChangePage = 'change-page',\n  AppendData = 'append-data'\n}\n\ninterface IChangeFilterAction<F> {\n  type: ActionType.ChangeFilter;\n  payload: Partial<F>;\n}\n\ninterface IChangePageAction {\n  type: ActionType.ChangePage;\n  payload: number;\n}\n\ninterface IAppendDataAction<T> {\n  type: ActionType.AppendData;\n  payload: T;\n}\n\ntype TActions<T, F> = IChangeFilterAction<F> | IChangePageAction | IAppendDataAction<T[]>;\n\nfunction constructURL(url: string, params: Record<string, unknown> = {}) {\n  const queryParams = Object.keys(params)\n    .map((paramName) => `${paramName}=${params[paramName]}`)\n    .join('&');\n\n  if (!queryParams) {\n    return url;\n  }\n\n  return `${url}?${queryParams}`;\n}\n\nfunction reducer<T, F>(state: IState<T, F>, action: TActions<T, F>): IState<T, F> {\n  const { type, payload } = action;\n  switch (type) {\n    default:\n      return state;\n    case ActionType.ChangeFilter:\n      // fixme: try to avoid using as\n      return { ...state, filter: { ...state.filter, ...payload } as F, currentPage: 1, data: [] };\n    case ActionType.ChangePage:\n      return { ...state, currentPage: payload };\n    case ActionType.AppendData:\n      return { ...state, data: [...state.data, ...payload]}\n  }\n}\n\nexport const usePagedFetch = <TData, F extends {} = {}>(\n  endpoint: string,\n  options?: IPagedFetchOptions<F>\n): IUsePagedFetchResult<TData, F> => {\n  const {\n    limit = 10,\n    page = 1,\n    filter\n  } = options ?? {};\n  const [state, dispatch] = useReducer<Reducer<IState<TData, F>, TActions<TData, F>>>(reducer<TData, F>, {\n    limit, \n    currentPage: page,\n    filter,\n    data: []\n  });\n  \n  const {\n    data: fetched,\n    status,\n    error\n  } = useFetch<IPagedResponse<TData>>(\n    constructURL(endpoint, { ...state.filter, page: state.currentPage, limit: state.limit }),\n    options\n  );\n\n  useEffect(() => {\n    if (fetched?.data) {\n      dispatch({ type: ActionType.AppendData, payload: fetched.data });\n    }\n  }, [fetched?.data]);\n\n  const getNextPage = useCallback(\n    () => dispatch({ type: ActionType.ChangePage, payload: state.currentPage + 1 }),\n    [state.currentPage]\n  );\n\n  const getPrevPage = useCallback(\n    () => dispatch({ type: ActionType.ChangePage, payload: state.currentPage - 1 }),\n    [state.currentPage]\n  );\n\n  const getSpecPage = useCallback(\n    (page: number) => dispatch({ type: ActionType.ChangePage, payload: page }),\n    []\n  );\n\n  const changeFilter = useCallback(\n    (filter: Partial<F>) => dispatch({ type: ActionType.ChangeFilter, payload: filter }),\n    []\n  );\n\n  return {\n    data: state.data,\n    filter: state.filter,\n    status,\n    error,\n    hasMore: Number(fetched?.totalPages) > state.currentPage,\n    totalPages: fetched?.totalPages,\n    getNextPage,\n    getPrevPage,\n    getSpecPage,\n    changeFilter\n  };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}